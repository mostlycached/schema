#!/usr/bin/env python3
"""
Enriched Scene: Morning at the Coffee Shop (December 10, 2025)
Based on the original image analysis + detailed journal reflection.
"""

from memoir_manager import MemoirRepo
from datetime import datetime
import uuid

# Enriched scene with specific details from memory/journal
scene_data = {
    "scene_id": str(uuid.uuid4()),
    "title": "Morning at the Coffee Shop (Enriched)",
    "date": "2025-12-10",
    "location": "Urban coffee shop with botanical interior",
    "duration": "~2 hours",
    "tags": ["coffee", "morning", "reading", "serres", "alexander", "didi-huberman", 
             "observation", "sociological", "primitive", "foliage"],
    
    "phenomenology": {
        "cognitive_style": {
            "time_experience": "Suspended - time slows in the warm light; deep reading creates pockets of flow until interrupted by awareness of others",
            "space_experience": "The foliage wrapped around the concrete column triggers something primitive - perhaps why I'm attracted to this place. Serres would argue for the body's memory of tree trunks. Will Alexander might stab at it with fractured language.",
            "attention_mode": "Oscillating: focused on philosophical text → diffuse awareness of conversations → sociological observation of the women → retreat into music (Agnes Obel)"
        },
        "intersubjectivity": {
            "shared_meanings": [
                "Coffee shop as third place - neither home nor work",
                "Books on table claim territory and signal intellectual work",
                "AirPods as exit strategy from unwanted ambient engagement",
                "Morning regulars recognize each other without speaking"
            ],
            "emotional_tone": "Contemplative calm, punctuated by mild sociological judgment, then withdrawal into private audio space",
            "intimacy_level": "Anonymous co-presence; briefly interested in the two women's conversation, then actively disengaged"
        },
        "body_experience": {
            "sensations": [
                "Warmth of drip coffee - holiday blend, bland but marketed",
                "Hard wooden chair, bentwood curves",
                "The green of the foliage filtering light",
                "AirPods sealing out the room's ambient noise",
                "Eyes moving between Serres' prose about mountain climbing and the women's gestures"
            ],
            "posture": "Seated at wooden table, slightly leaning forward over three books stacked/spread; beanie on",
            "mobility": "Stationary for extended period; occasional sip, page turn, phone check"
        }
    },
    
    "structure": {
        "capital": {
            "economic": "Cost of holiday blend drip coffee (~$4-5) - the cheapest option, but with 'holiday' appended to devalue the word further",
            "cultural": "Three books signaling specific intellectual lineage: Serres (phenomenology of body/nature), Will Alexander (avant-garde Black Surrealism), Didi-Huberman (art theory/phenomenology of light). This is not casual reading.",
            "social": "Regularity creates recognition; comfort being alone in public; capacity to tune out via AirPods",
            "symbolic": "The books as identity markers: philosophy of embodiment, fractal poetics, chromatic phenomenology. A particular kind of intellectual."
        },
        "doxa": {
            "beliefs": [
                "Good coffee shops feel like a living room with primitive botanical undertones",
                "Foliage wrapped around concrete columns might explain why certain spaces attract certain people",
                "Holiday blend is a currency devaluation operation on the word 'holiday'",
                "Some conversations in public are worth listening to; most are not"
            ],
            "taboos": [
                "Overstaying judgment on strangers (but doing it anyway)",
                "Admitting attraction and dismissal in the same observation",
                "The hierarchy of 'interesting' conversations"
            ]
        },
        "habitus": {
            "behaviors": [
                "Reading first chapter of Serres - about climbing mountains",
                "Reading first poem of Will Alexander's Philosophical Fractal",
                "Not reading Didi-Huberman today, but Roden Crater stayed in background of mind",
                "Listening to two women's conversation for a while",
                "Putting on AirPods when losing interest",
                "Playing Agnes Obel as withdrawal"
            ],
            "gestures": [
                "Careful page turns",
                "Glancing up to observe the women",
                "Inserting AirPods as exit ritual",
                "Looking at foliage and thinking about tree trunks"
            ],
            "language_style": "Internal monologue: philosophical (Serres), observational (the women), judgmental (their sociological profile), then musical retreat"
        },
        "hierarchy": {
            "position": "Customer/observer - temporarily above the observed (the women) in claimed intellectual position, but this is contested",
            "mobility": "Free to stay or go; free to listen or withdraw; economic barrier is low"
        }
    },
    
    "system": {
        "function": {
            "primary": "Third place for reading and observation; site of sociological micro-study",
            "secondary": [
                "Testing philosophical ideas against lived experience",
                "Practicing observational judgment",
                "Escape into music when ambient becomes boring"
            ]
        },
        "binary_code": {
            "code": "interesting/boring; attractive/dismissed; primitive/constructed",
            "position": "Scanner who decides what merits attention"
        },
        "boundaries": {
            "entry_criteria": [
                "Willingness to purchase (even bland holiday coffee)",
                "Books as legitimacy props",
                "Capacity for sustained attention oscillation"
            ],
            "exit_criteria": [
                "Conversation becomes uninteresting → AirPods",
                "Reading reaches natural pause",
                "Next obligation"
            ]
        }
    },
    
    "inhabitants": [
        {
            "role": "Self as reader/observer",
            "relationship": "Primary actor oscillating between absorbed reading and ambient scanning",
            "details": "Wearing beanie, reading three philosophy books, drinking holiday blend, listening to Agnes Obel",
            "name": ""
        },
        {
            "role": "Woman on the left",
            "relationship": "Observed subject - object of sociological/aesthetic judgment",
            "details": "Talking about Michael (ex?) and Patrick. Moderately attractive, heavier around the torso. In her late 30s.",
            "name": ""
        },
        {
            "role": "Woman on the right",
            "relationship": "Observed subject - interlocutor of woman on left",
            "details": "Similar profile to woman on left. They're bonding over relationships and commenting on each other's sweaters/hats.",
            "name": ""
        },
        {
            "role": "The foliage around the concrete column",
            "relationship": "Environmental trigger for primitive thought",
            "details": "Wrapped around concrete - maybe reminds me of a tree trunk. Why I'm attracted to this place?",
            "name": ""
        },
        {
            "role": "The three books",
            "relationship": "Intellectual companions and identity markers",
            "details": "Serres 'Variations of the Body' (read part of first chapter on climbing), Will Alexander 'Philosophical Fractal' (read first poem), Didi-Huberman 'The Man Who Walked in Color' (Roden Crater chapter in background of mind)",
            "name": ""
        }
    ],
    
    "narrative": {
        "description": """Mid-morning. The coffee shop glows with natural light filtered through massive plants. I've ordered a holiday blend - drip coffee, the bland option, but with 'holiday' thrown in, further devaluing that word's currency. 

Three books on my table: Michel Serres' Variations of the Body (I read part of the first chapter today - about climbing mountains), Will Alexander's Philosophical Fractal (I read the first poem), and Georges Didi-Huberman's The Man Who Walked in Color (I didn't read it today, but the chapter about Roden Crater stayed in the background of my mind).

I look at the foliage in front of me, wrapped around a concrete column. Maybe it reminds me of a tree trunk - maybe that's why I'm attracted to this place. Something primitive, like Serres would argue. Will Alexander might stab at it with his fractured language.

Two women sit in front of me. The woman on the left is talking about her relationships: Michael, someone she seems to have broken up with. And Patrick - not sure if that's someone else she dated. She's moderately attractive but heavier around the torso. The other woman fits a similar profile. Late 30s, bonding over relationships, commenting on how cute their sweaters and hats are.

I find myself constructing their sociological profile automatically. Women in their late 30s, this particular physical type, this particular conversation type, this particular friendship ritual.

Then I lose interest. I put on my AirPods and play Agnes Obel. The conversation fades. The coffee shop becomes private again. The books wait. The foliage keeps wrapping around its concrete column, and I keep wondering about what makes this place feel right.""",
        
        "key_moments": [
            "Looking at foliage and thinking 'maybe it reminds me of a tree trunk'",
            "Hearing 'Michael' and 'Patrick' - fragments of someone else's relational history",
            "The moment of judging: 'moderately attractive, heavier around the torso'",
            "Putting on AirPods as active withdrawal",
            "Serres on climbing mountains while I sit still"
        ],
        "turning_points": [
            "The shift from interested observation to boredom with the women's conversation",
            "The exit into Agnes Obel - choosing private audio over ambient social"
        ]
    },
    
    "reflection": {
        "significance": """This scene captures the oscillation between three modes:
1. Absorbed reading (Serres, Alexander, Didi-Huberman in background)
2. Ambient observation (the women, the foliage, the space)
3. Judgment and withdrawal (constructing sociological profiles, then exiting via music)

The intellectual apparatus (three very specific books) frames how I see: Serres makes me think about the primitive appeal of the foliage. Alexander makes me want to fracture language around what I observe. Didi-Huberman's Roden Crater (a walk through colored light) stays as background mood.

The judgment of the women is uncomfortable but honest: I'm constructing a type, assessing attractiveness, noticing body type, listening to their conversation as data. When it stops being interesting, I exit. The AirPods are a power move - I can choose what to hear.

The holiday blend coffee is a small example of linguistic devaluation: 'holiday' as marketing append to a bland product.""",
        
        "patterns": [
            "Reading philosophy while observing ordinary life - testing theory against the mundane",
            "Automatic sociological profiling of strangers",
            "The attractiveness assessment happening alongside intellectual observation",
            "Music (Agnes Obel) as controlled withdrawal from ambient noise",
            "Attention to language: 'holiday blend' as currency devaluation"
        ],
        
        "questions": [
            "Is the 'tree trunk' attraction to foliage an example of what Serres means by the body's memory?",
            "What does it mean that I construct sociological profiles automatically? Is this a trained habit or a defense?",
            "The judgment of the women - is this observation or dismissal?",
            "Why do the three books stay relevant even when I'm not reading them?",
            "What would Will Alexander make of this coffee shop? How would he fractal it?"
        ]
    },
    
    "metadata": {
        "captured_at": datetime.now().isoformat(),
        "interview_mode": "journal_reflection",
        "books_present": [
            "Michel Serres - Variations of the Body (reading chapter on climbing)",
            "Will Alexander - Philosophical Fractal (read first poem)",
            "Georges Didi-Huberman - The Man Who Walked in Color (Roden Crater in background mind)"
        ],
        "music": "Agnes Obel (via AirPods, as withdrawal)",
        "coffee": "Holiday blend drip (bland + marketing)"
    }
}

if __name__ == "__main__":
    repo = MemoirRepo()
    scene_id = repo.save_scene(scene_data)
    
    print(f"\n✓ Enriched coffee shop scene captured!")
    print(f"  ID: {scene_id}")
    print(f"  Title: {scene_data['title']}")
    print(f"\nBooks present:")
    for book in scene_data['metadata']['books_present']:
        print(f"  - {book}")
    print(f"\nKey observation: 'Maybe the foliage reminds me of a tree trunk - something primitive'")
    print(f"Key moment: Putting on AirPods to exit the women's conversation")
    print(f"\nTo view scene: python3 probe/memoir_manager.py --list-scenes")
